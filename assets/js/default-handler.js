"use strict";!function(e){function t(t){var n=this;e.SPFormRegistry=e.SPFormRegistry||{},n.id=t,n.formSelector="#sp-form-"+n.id,n.$form=p(n.formSelector),n.$formMessage=p(n.formSelector+" .sp-message"),n.$formOuter=p(n.formSelector).parent(".sp-form-outer").length?p(n.formSelector).parent(".sp-form-outer"):p(n.formSelector).parent(".form-outer"),n.$submitButton=p(n.formSelector+" button.sp-button"),n.$closeButton=p(n.formSelector+" .sp-btn-close"),n.formHash=n.$form.attr("sp-hash"),n.formType=n.$form.hasClass("sp-form-popup")?"popup":"embed",n.formType=n.$form.hasClass("sp-form-fixed")?"fixed":n.formType,n.inputs={},n.inputsSelector=n.formSelector+" .sp-element-container :input",n.language=n.$form.attr("sp-lang"),n.preparedData={},n.sent=!1,n.showOptions=function(){var e=n.$form.attr("sp-show-options")?JSON.parse(decodeURIComponent(n.$form.attr("sp-show-options"))):{};return e.amd&&(u=f),void 0===e.urlFilter&&(e.urlFilter=!1),void 0===e.urlFilterConditions&&(e.urlFilterConditions=[]),e}(),n.submitURL=function(){var t;switch(e.location.hostname){case"localhost":t=l;break;case"qa.dev":t=c;break;default:t=u}return t+"/members/forms/jsonp-submit"}(),n.history=new r(n.formHash),n.valid=!0,n.ipInfo={},n.previewSites=["forms.sendpulse.com","forms.sendpulse.dev","forms.routee.net"],n.previewMode=-1!==n.previewSites.indexOf(e.location.hostname),n.urlFilter=new o({active:!n.previewMode&&n.showOptions.urlFilter,conditions:n.showOptions.urlFilterConditions}),n.init()}function o(t){function o(e){return e.replace(/((^\w+:|^)\/\/)|(\/$)/g,"")}var r=this;r.config={active:!1,conditions:[],url:o(e.location.href)},r.config=p.extend(r.config,t),r.rules=function(e){var t={show:"",hide:""};return e.forEach(function(e){var r=o(e.token);switch(e.clause){case"contains":t[e.force]+=r+"|";break;case"equal":t[e.force]+="^"+r+"$|";break;case"begins":t[e.force]+="^"+r+"|";break;case"ends":t[e.force]+=r+"$|"}}),t}(r.config.conditions)}function r(e){var t=this;t.formHash=e,t.all=t.raise()}function n(){}function s(t){new Promise(function(t,o){void 0===e.jQuery?n.loadScript("//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js",function(){p=e.jQuery}).then(function(){t()}):(p=e.jQuery,t())}).then(t)}function i(){switch(e.location.hostname){case"localhost":case"forms.sendpulse.dev":d="login.sendpulse.dev";break;case"qa.dev":d="login.sendpulse.test";break;default:d="static-login.sendpulse.com"}var o=[],r=p('div.sp-form [name="sform[phone]"]'),s=p('div[class*=" sp-animation-"]'),i=a();new Promise(function(e,t){r.length>0&&(o.push(n.loadCss("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/css/intlTelInput.css")),o.push(n.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/intlTelInput.min.js")),o.push(n.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"))),s.length>0&&o.push(n.loadCss("//"+d+"/apps/fc3/build/form-animations.css?1509374402859")),o.push(n.loadScript("//cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.3.6/mobile-detect.min.js")),o.push(n.loadCss("//"+d+"/apps/fc3/build/form-defaults.css?1509374402859")),Promise.all(o).then(function(){e()},function(e){console.error("Necessary scripts have not been loaded:",e)})}).then(function(){for(var e=0,o=i.length;e<o;e++)new t(i[e]).run()})}function a(){var e=p("div.sp-form"),t=e.length,o=[];if(!t)throw new Error("SendPulse: Subscription form ID is missing or code is corrupted!");for(var r=0;r<t;r++)o.push(p(e[r]).attr("sp-id"));return o}var p,u="//login.sendpulse.com",l="//login.sendpulse.dev",c="//login.sendpulse.test",f="//email.routee.net",d="";t.prototype.init=function(){var e=this;return e.$closeButton.on("click",function(t){e.close(!0)}),e.$submitButton.prop("disabled",!e.valid),p(e.inputsSelector).each(function(t,o){var r=p(o);r.hideTip=function(){r.hasClass("sp-invalid")&&(this.removeClass("sp-invalid"),this.next(".sp-tip").detach())},r.showTip=function(e){var t=JSON.parse(decodeURIComponent(this.attr("sp-tips")));this.addClass("sp-invalid"),t.hasOwnProperty(e)&&this.after(p("<div/>",{class:"sp-tip sp-invalid",html:t[e]}))},r.on("focus",function(){e.hideAllTips()}),"sform[phone]"===r.attr("name")&&r.intlTelInput({initialCountry:"auto",separateDialCode:!0,geoIpLookup:function(t){p.get("//ipinfo.io",function(){},"jsonp").always(function(o){e.ipInfo=o;var r=o&&o.country?o.country:"";t(r)})},utilScript:"//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"}),e.inputs[o.name]=r}),e.$submitButton.off("click").on("click",function(t){e.submit()}),e.previewMode&&(e.$form.removeClass("sp-form-popup"),e.$form.removeClass("sp-form-fixed"),e.$formOuter.removeClass("sp-popup-outer"),e.$closeButton.remove()),e},t.prototype.run=function(){this.show()},t.prototype.hideAllTips=function(){var e=this;for(var t in e.inputs)e.inputs.hasOwnProperty(t)&&e.inputs[t].hasOwnProperty("hideTip")&&e.inputs[t].hideTip()},t.prototype.disableInputs=function(){var e=this;p(e.inputsSelector).prop("disabled",!0),e.$submitButton.prop("disabled",!0)},t.prototype.enableInputs=function(){var e=this;p(e.inputsSelector).prop("disabled",!1),e.$submitButton.prop("disabled",!1)},t.prototype.close=function(e){var t=this;"embed"!==t.formType&&(t.$formOuter.addClass("sp-hide"),e&&!t.history.getSubmits().length&&t.history.addReject((new Date).getTime()))},t.prototype.show=function(){function t(e){e=e||.2,e*=1e3,setTimeout(function(){o.$formOuter.addClass("sp-showing"),setTimeout(function(){o.$formOuter.addClass("sp-show")},200),setTimeout(function(){o.$formOuter.removeClass("sp-showing")},400)},e)}var o=this;if(!(function(){if(o.showOptions.hideOnMobile){return new MobileDetect(e.navigator.userAgent).mobile()}return!1}()||!o.urlFilter.isAllowed()&&"embed"!==o.formType||function(){if("onButtonClick"===o.showOptions.condition)return p("[sp-show-form]").on("click",function(){var e=p(this).attr("sp-show-form");p("#sp-form-"+e).parent(".sp-form-outer").removeClass("sp-force-hide").removeClass("sp-hide").addClass("sp-show")}),!0}())){if(o.$formOuter.removeClass("sp-force-hide"),o.previewMode)return void t();if("embed"!==o.formType){if(o.history.getSubmits().length)return;if(o.history.getRejects().length>1)return;if(1===o.history.getRejects().length){var r=(new Date).getTime(),n=(r-o.history.getLastShow())/864e5;if(o.showOptions.repeat>0&&n<o.showOptions.repeat)return}"popup"!==o.formType&&"fixed"!==o.formType||function(){switch(o.showOptions.condition){case"onEnter":t(o.showOptions.delay);break;case"onScroll":p(e).scroll(function(){var r=(p(document).height()-p(e).height())/100*o.showOptions.scrollTo;p(e).scrollTop()>=r&&t()});break;case"onCursorLeave":p("body").on("mouseleave",function(){t()});break;case"onClose":p(e).on("unload",function(e){e.preventDefault(),t()})}}()}o.history.addLastShow()}},t.prototype.validateAll=function(){var e=this;e.valid=!0;for(var t in e.inputs)if(e.inputs.hasOwnProperty(t)&&void 0!==e.inputs[t].attr("sp-type")){var o=e.inputs[t],r=e.validate(o);e.valid=e.valid&&r}return e},t.prototype.validate=function(e){var t=this,o=e.attr("sp-type");if(void 0===o)return!0;"sform[phone]"===e.name&&(o="phone");var r=!0,n=e.val();if(e.hideTip(),e.prop("required"))switch(o){case"checkbox":r=e.prop("checked");break;default:r=""!==n}if(!r)return e.showTip("required"),t.$submitButton.prop("disabled",!1),r;if(e.prop("required")&&""===n)return r=!1,e.showTip("required"),t.$submitButton.prop("disabled",!1),r;if(r&&""!==n)switch(o){case"address":case"date":r=!0;break;case"email":r=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}(n);break;case"phone":e.prop("required")&&(r=function(t){return!!p.trim(e.val())&&e.intlTelInput("isValidNumber")}(e))}return r||e.showTip("wrong"),r},t.prototype.cbSubmit=function(t){var o=this;t.hasOwnProperty("html")&&t.hasOwnProperty("status")&&("success"===t.status?(o.$formMessage.addClass("sp-message-success"),o.sent=!0,o.history.addSubmit(),o.$formMessage.html(t.html),o.enableInputs()):"verify"===t.status?(o.sent=!0,o.history.addSubmit(),o.enableInputs(),o.close(),e.location.href="//"+d+"/forms/recaptcha?hash="+t.form_hash):(o.$formMessage.addClass("sp-message-error"),o.$formMessage.html(t.html),o.enableInputs())),o.removeInstanceFromRegistry()},t.prototype.submit=function(){var t=this;if("popup"===t.formType&&t.history.getSubmits().length>1)throw new Error("Form has been submitted twice already. Enough!");t.sent||(t.validateAll(),t.valid&&(t.disableInputs(),t.putInstanceToRegistry(),function(){for(var o in t.inputs)if(t.inputs.hasOwnProperty(o)){var r=t.inputs[o];switch(r.attr("sp-type")){case"phone":t.preparedData[o]=r.intlTelInput("getNumber");break;case"checkbox":r.prop("checked")?t.preparedData[o]=r.val():t.preparedData[o]="no";break;case"radio":t.preparedData[o]=p('[name="'+o+'"]:checked').val();break;default:t.preparedData[o]=r.val()}}t.preparedData.sform_lang=t.language,t.preparedData["sform[hash]"]=t.formHash,t.preparedData["sform["+e.btoa("autoSite")+"]"]=e.location.hostname,p.isEmptyObject(t.ipInfo)||(t.preparedData["sform["+e.btoa("autoIp")+"]"]=t.ipInfo.ip,t.preparedData["sform["+e.btoa("autoCity")+"]"]=t.ipInfo.city,t.preparedData["sform["+e.btoa("autoRegion")+"]"]=t.ipInfo.region,t.preparedData["sform["+e.btoa("autoCountry")+"]"]=t.ipInfo.country)}(),function(){p.ajax({url:t.submitURL+"?callback=?",dataType:"jsonp",data:t.preparedData,jsonpCallback:t.makeCallbackName("cbSubmit")})}()))},t.prototype.makeCallbackName=function(e){return"SPFormRegistry['"+this.formHash+"']."+e},t.prototype.putInstanceToRegistry=function(){var t=this;e.SPFormRegistry[t.formHash]=t},t.prototype.removeInstanceFromRegistry=function(){var t=this;void 0!==e.SPFormRegistry[t.formHash]&&delete e.SPFormRegistry[t.formHash]},o.prototype.isAllowed=function(){var e=this;return!e.config.active||function(){var t={show:!1,hide:!0},o=0;return $.each(e.rules,function(r,n){n.length>0?(e.rules[r]=new RegExp(n.slice(0,-1),"i"),t[r]=e.rules[r].test(e.config.url)):o+=1}),2===o&&(t.show=!0),t.show+!t.hide}()},r.prototype.raise=function(){var e=this;if(localStorage[e.formHash])try{return JSON.parse(localStorage.getItem(e.formHash))}catch(e){console.error(e)}return{submits:[],rejects:[],lastShow:0}},r.prototype.persist=function(){var e=this;localStorage.setItem(e.formHash,JSON.stringify(e.all))},r.prototype.add=function(e,t){var o=this;switch(t=t||(new Date).getTime(),e){case"submits":case"rejects":o.all[e].push(t);break;case"lastShow":o.all[e]=t}o.persist()},r.prototype.addSubmit=function(e){this.add("submits",e)},r.prototype.addReject=function(e){this.add("rejects",e)},r.prototype.addLastShow=function(e){this.add("lastShow",e)},r.prototype.get=function(e){var t=this;if(t.all.hasOwnProperty(e))return t.all[e]},r.prototype.getSubmits=function(){return this.get("submits")},r.prototype.getRejects=function(){return this.get("rejects")},r.prototype.getLastShow=function(){return this.get("lastShow")},n.loadScript=function(e,t,o){return new Promise(function(r,n){var s=document.createElement("script");void 0===o&&(o=!1),s.type="text/javascript",s.async=!0,s.src=e+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof t&&t(),r())}:s.onload=function(){"function"==typeof t&&t(),r()},s.onerror=function(){n(new Error("Loading fail! "+e))}})},n.loadCss=function(e,t,o){return new Promise(function(r,n){var s=document.createElement("link");void 0===o&&(o=!1),s.rel="stylesheet",s.media="screen",s.href=e+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof t&&t(),r())}:s.onload=function(){"function"==typeof t&&t(),r()},s.onerror=function(){n(new Error("Loading fail! "+e))}})},n.loadPromisePolyfill=function(e,t){var o="//polyfill.io/v2/polyfill.min.js?flags=gated,always&features=Promise,&rum=0",r=document.createElement("script");void 0===t&&(t=!1),r.type="text/javascript",r.async=!1,r.src=o+(t?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(r),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,"function"==typeof e&&e())}:r.onload=function(){"function"==typeof e&&e()},r.onerror=function(){throw new Error("Loading fail! "+o)}},e.onload=function(){"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?s(i):n.loadPromisePolyfill(function(){s(i)})}}(window);
//# sourceMappingURL=default-handler.js.map
